#!/usr/bin/env bash
#
# {{ job_name }} - Job script
# Generated by OpsArtisan
#
{% if schedule_type == 'cron' %}
# Cron schedule: {{ schedule }}
{% elif schedule_type == 'systemd' %}
# systemd schedule: {{ systemd_schedule }}
{% elif schedule_type == 'kubernetes' %}
# Kubernetes schedule: {{ schedule }}
{% endif %}

set -euo pipefail

# Configuration
JOB_NAME="{{ job_name }}"
{% if logging_enabled and schedule_type != 'kubernetes' %}
LOG_FILE="{{ log_path }}"
{% endif %}
{% if working_directory %}
WORK_DIR="{{ working_directory }}"
{% endif %}

# Logging function
log() {
    local level="$1"
    shift
    local message="$*"
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    echo "[${timestamp}] [${level}] ${message}"
{% if logging_enabled and schedule_type != 'kubernetes' %}
    echo "[${timestamp}] [${level}] ${message}" >> "${LOG_FILE}"
{% endif %}
}

# Error handler
error_exit() {
    log "ERROR" "$1"
{% if error_notification and schedule_type == 'cron' %}
    echo "$1" | mail -s "Job Failed: ${JOB_NAME}" {{ notification_email }}
{% endif %}
    exit 1
}

# Trap errors
trap 'error_exit "Job failed on line $LINENO"' ERR

# Main job logic
main() {
    log "INFO" "Starting job: ${JOB_NAME}"

{% if working_directory %}
    # Change to working directory
    cd "${WORK_DIR}" || error_exit "Failed to change to working directory"
    log "INFO" "Working directory: $(pwd)"
{% endif %}

    # ============================================
    # YOUR JOB LOGIC HERE
    # ============================================

    # Example: Run your command
    log "INFO" "Executing: {{ command }}"
    {{ command }}

    # ============================================

    log "INFO" "Job completed successfully"
}

# Run main function
main "$@"
