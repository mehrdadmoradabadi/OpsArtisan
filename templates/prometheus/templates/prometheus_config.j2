# Prometheus configuration
# Generated by OpsArtisan

global:
  scrape_interval: {{ scrape_interval }}
  evaluation_interval: 30s
  external_labels:
    cluster: 'production'
    environment: 'prod'

# Alertmanager configuration
{% if include_alerts %}
alerting:
  alertmanagers:
    - static_configs:
        - targets:
            - '{{ alertmanager_url.replace("http://", "").replace("https://", "") }}'
{% endif %}

# Rule files
rule_files:
  {% if include_alerts %}- 'rules/*-alerts.yml'{% endif %}
  {% if include_recording_rules %}- 'rules/*-recording.yml'{% endif %}

# Scrape configurations
scrape_configs:
  # Prometheus self-monitoring
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']

  {% if include_alerts %}
  # Alertmanager
  - job_name: 'alertmanager'
    static_configs:
      - targets: ['{{ alertmanager_url.replace("http://", "").replace("https://", "") }}']
  {% endif %}

  # Include external scrape configs
  - job_name: 'file_sd'
    file_sd_configs:
      - files:
          - 'scrape-configs/*.yml'
        refresh_interval: 5m

# Storage configuration
storage:
  tsdb:
    path: './data'
    retention:
      time: 15d
      size: 50GB
