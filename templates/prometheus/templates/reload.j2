#!/bin/bash
#
# Reload Prometheus configuration
# Generated by OpsArtisan
#

set -euo pipefail

PROMETHEUS_URL="${PROMETHEUS_URL:-http://localhost:9090}"

echo "==> Reloading Prometheus configuration"

# Try HTTP reload first
if curl -X POST "${PROMETHEUS_URL}/-/reload" 2>/dev/null; then
    echo "==> Prometheus reloaded via HTTP"
elif systemctl is-active --quiet prometheus; then
    echo "==> Reloading via systemctl"
    sudo systemctl reload prometheus
    echo "==> Prometheus reloaded via systemctl"
else
    echo "ERROR: Could not reload Prometheus"
    echo "Try manually: sudo systemctl reload prometheus"
    exit 1
fi

# Wait a bit for reload
sleep 2

# Check if Prometheus is healthy
if curl -sf "${PROMETHEUS_URL}/-/healthy" > /dev/null; then
    echo "✅ Prometheus is healthy"
else
    echo "⚠️  Prometheus health check failed"
    exit 1
fi

echo ""
echo "==> Reload complete!"
echo "Visit: ${PROMETHEUS_URL}"
