stages:
  - build
  - test
  {% if include_deploy %}- deploy{% endif %}

build:
  stage: build
  image: {{ "python:3.10" if language == "python" else "node:18" if language == "node" else "golang:1.20" }}
  script:
    {% if language == "python" %}
    - pip install -r requirements.txt
    {% elif language == "node" %}
    - npm install
    {% elif language == "go" %}
    - go build ./...
    {% endif %}

test:
  stage: test
  script:
    {% if language == "python" %}
    - pytest
    {% elif language == "node" %}
    - npm test
    {% elif language == "go" %}
    - go test ./...
    {% endif %}

{% if include_deploy %}
deploy:
  stage: deploy
  script:
    - echo "Deploy step placeholder"
{% endif %}
