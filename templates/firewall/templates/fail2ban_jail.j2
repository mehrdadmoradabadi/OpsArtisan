{% if enable_fail2ban_integration and configuration_mode == 'advanced' %}
# Fail2ban jail configuration
# Generated by OpsArtisan

[DEFAULT]
bantime  = 3600
findtime  = 600
maxretry = 5
backend = systemd

{% if allow_ssh %}
[sshd]
enabled = true
port    = {{ ssh_port }}
filter  = sshd
logpath = /var/log/auth.log
maxretry = 3
bantime = 7200
{% endif %}

{% if server_role == 'web' %}
[nginx-http-auth]
enabled = true
filter  = nginx-http-auth
port    = http,https
logpath = /var/log/nginx/error.log
maxretry = 3

[nginx-noscript]
enabled  = true
port     = http,https
filter   = nginx-noscript
logpath  = /var/log/nginx/access.log
maxretry = 6

[nginx-badbots]
enabled  = true
port     = http,https
filter   = nginx-badbots
logpath  = /var/log/nginx/access.log
maxretry = 2

[nginx-noproxy]
enabled  = true
port     = http,https
filter   = nginx-noproxy
logpath  = /var/log/nginx/access.log
maxretry = 2
{% endif %}

[recidive]
enabled  = true
filter   = recidive
logpath  = /var/log/fail2ban.log
action   = iptables-allports[name=recidive]
bantime  = 86400
findtime = 86400
maxretry = 3
{% endif %}
