#!/usr/bin/env bash
set -e

CN="{{ common_name }}"
ORG="{{ org }}"
C="{{ country }}"

# Generate private key
openssl genrsa -out ${CN}.key 2048

{% if mode == "csr" %}
# Generate CSR
openssl req -new -key ${CN}.key -out ${CN}.csr \
  -subj "/C=${C}/O=${ORG}/CN=${CN}"
echo "CSR generated: ${CN}.csr (send this to your CA)"
{% else %}
# Generate self-signed certificate
openssl req -new -x509 -key ${CN}.key -out ${CN}.crt -days {{ days }} \
  -subj "/C=${C}/O=${ORG}/CN=${CN}"
echo "Self-signed cert generated: ${CN}.crt"
{% endif %}
