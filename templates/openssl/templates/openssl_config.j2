# OpenSSL Configuration File
# Generated by OpsArtisan

[ req ]
default_bits       = {{ key_size }}
{% if configuration_mode == 'advanced' %}
default_md         = {{ hash_algorithm }}
{% else %}
default_md         = sha256
{% endif %}
distinguished_name = req_distinguished_name
{% if include_san %}
req_extensions     = v3_req
{% endif %}
{% if cert_type == 'ca' %}
x509_extensions    = v3_ca
{% endif %}
prompt             = no

[ req_distinguished_name ]
C  = {{ country }}
{% if configuration_mode == 'advanced' %}
ST = {{ state }}
L  = {{ locality }}
{% endif %}
O  = {{ organization }}
{% if configuration_mode == 'advanced' %}
OU = {{ organizational_unit }}
{% endif %}
CN = {{ common_name }}
{% if configuration_mode == 'advanced' %}
emailAddress = {{ email }}
{% endif %}

{% if include_san %}
[ v3_req ]
basicConstraints = CA:FALSE
keyUsage = nonRepudiation, digitalSignature, keyEncipherment
subjectAltName = @alt_names

[ alt_names ]
DNS.1 = {{ common_name }}
{% set dns_counter = [2] %}
{% if san_domains %}
{% for domain in san_domains.split(',') %}
DNS.{{ dns_counter[0] }} = {{ domain.strip() }}
{% if dns_counter.append(dns_counter.pop() + 1) %}{% endif %}
{% endfor %}
{% endif %}
{% if san_ips and configuration_mode == 'advanced' %}
{% set ip_counter = [1] %}
{% for ip in san_ips.split(',') %}
{% if ip.strip() %}
IP.{{ ip_counter[0] }} = {{ ip.strip() }}
{% if ip_counter.append(ip_counter.pop() + 1) %}{% endif %}
{% endif %}
{% endfor %}
{% endif %}
{% endif %}

{% if cert_type == 'ca' %}
[ v3_ca ]
basicConstraints = critical,CA:TRUE
keyUsage = critical, digitalSignature, cRLSign, keyCertSign
subjectKeyIdentifier = hash
authorityKeyIdentifier = keyid:always,issuer
{% endif %}