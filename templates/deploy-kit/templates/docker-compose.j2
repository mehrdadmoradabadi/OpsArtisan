version: "3.9"

services:
  {{ project_name }}:
    build: .
    ports:
      - "{{ app_port }}:{{ app_port }}"
    restart: unless-stopped

{% if db_type != "none" %}
  {{ db_type }}:
    image: {{ "postgres:15" if db_type == "postgres" else "mysql:8" }}
    environment:
      {% if db_type == "postgres" %}
      POSTGRES_USER: {{ project_name }}
      POSTGRES_PASSWORD: password
      POSTGRES_DB: {{ project_name }}
      {% else %}
      MYSQL_ROOT_PASSWORD: password
      MYSQL_DATABASE: {{ project_name }}
      {% endif %}
    volumes:
      - db_data:/var/lib/{{ db_type }}
{% endif %}

volumes:
  db_data:
